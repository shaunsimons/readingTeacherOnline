{% extends 'base.html' %}
{% block content %}

<div class="container my-5">
    <h3>Account Settings</h3>

    <p>Account Created: {{ date_joined| date:"d M Y" }}</p>

    {% if session %}
        <p>Premium Access Till: {{ member_until| date:"d M Y" }}</p>
        <button type="submit" class="btn btn-primary" id="update-button">Update Payment Details</button>

            <div class="text-center pt-3">
                <script src="https://js.stripe.com/v3/"></script>

                <script>
                    var stripe = Stripe('{{ stripe_public_key }}');

                    var checkoutButton = document.getElementById('update-button');

                    checkoutButton.addEventListener('click', function() {
                      stripe.redirectToCheckout({
                        sessionId: '{{ session.id }}'
                      }).then(function (result) {
                        // If `redirectToCheckout` fails due to a browser or network
                        // e                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          rror, display the localized error message to your customer
                        // using `result.error.message`.

                      });
                    });
                </script>
            </div>

        <a href="{% url 'change_password' %}">
        <button type="button" class="btn btn-primary">Reset Password</button>
       </a>

        {% if not cancel_at_end_period %}
            <form action="{% url 'memberships:cancel_subscription' %}" method="GET">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" id="cancel-button">Cancel Membership</button>
            </form>
        {% else %}
            <p class="alert-info p-2 my-3">You have cancelled your membership and will end on {{ member_until| date:"d M Y" }}</p>
        {% endif %}


    {% endif %}
</div>
{% endblock %}
